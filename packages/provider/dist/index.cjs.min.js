"use strict";var e=function(){return(e=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};var t=function(e){try{return decodeURIComponent(e)}catch(t){return e}};var n={setPlay:function(){var e=this,t=this.config.$video.play();if("undefined"!=typeof Promise&&-1!==Promise.toString().indexOf("[native code]"))t.then((function(){e.postVideoMessage({eventType:"reply-set-play",value:{resolved:!0}})})).catch((function(){e.postVideoMessage({eventType:"reply-set-play",value:{resolved:!1}})}));else{var n=this.config.$video.paused;this.postVideoMessage({eventType:"reply-set-play",value:{resolved:!n}})}},setPause:function(){this.config.$video.pause()},setMuted:function(e){e&&"muted"in e&&(this.config.$video.muted=e.muted)},setPresentationMode:function(e){e&&"presentationMode"in e&&this.config.$video.webkitSetPresentationMode(e.presentationMode)},getDuration:function(){this.postVideoMessage({eventType:"reply-get-duration",value:{seconds:this.config.$video.duration}})},getCurrentTime:function(){this.postVideoMessage({eventType:"reply-get-current-time",value:{seconds:this.config.$video.currentTime}})},getMuted:function(){this.postVideoMessage({eventType:"reply-get-muted",value:{muted:this.config.$video.muted}})},getPresentationMode:function(){this.postVideoMessage({eventType:"reply-get-presentation-mode",value:{presentationMode:this.config.$video.webkitPresentationMode}})},getPlayBackRate:function(){this.postVideoMessage({eventType:"reply-get-playbackRate",value:{playbackRate:this.config.$video.playbackRate}})},canPlay:function(){this.postVideoMessage({eventType:"can-play",value:null})},pause:function(){this.postVideoMessage({eventType:"pause",value:null})},play:function(){this.postVideoMessage({eventType:"play",value:null})},ended:function(){this.postVideoMessage({eventType:"ended",value:null})},timeUpdate:function(){this.postVideoMessage({eventType:"time-update",value:{currentTime:this.config.$video.currentTime}})},volumeChange:function(){this.postVideoMessage({eventType:"volume-change",value:{volume:this.config.$video.volume,muted:this.config.$video.muted}})},seeking:function(){this.postVideoMessage({eventType:"seeking",value:{currentTime:this.config.$video.currentTime}})},seeked:function(){this.postVideoMessage({eventType:"seeked",value:{currentTime:this.config.$video.currentTime}})},rateChange:function(){this.postVideoMessage({eventType:"rate-change",value:{playbackRate:this.config.$video.playbackRate}})},presentationModeChanged:function(){this.postVideoMessage({eventType:"presentation-mode-changed",value:{presentationMode:this.config.$video.webkitPresentationMode}})},error:function(e){this.postVideoMessage({eventType:"error",value:{message:e.name+": "+e.message}})}},o=function(){function o(o){var i,s=this;this.config=e({},o),this.actions=e({},n);var a,c,r,u=o.$video;u instanceof HTMLVideoElement||n.error.call(this,new TypeError("config.$video 不是 HTMLVideoElement 实例; "+Object.prototype.toString.call(o.$video))),(void 0===o.controls?"0"!==(a=location.search,c=a.replace(/^\?/,"").split("&"),r={},c.forEach((function(e){if(e){var n=e.indexOf("=");if(-1!==n){var o=t(e.slice(0,n)),i=t(e.slice(n+1));r[o]=i}else{var s=t(e);r[s]=""}}})),r).controls:o.controls)?u.setAttribute("controls","controls"):u.removeAttribute("controls");var d=null!==(i=o.actions)&&void 0!==i?i:{};Object.keys(d).forEach((function(e){if(e in n&&"function"==typeof d[e]){var t=e;s.actions[t]=d[t]}}));["canPlay","pause","play","ended","timeUpdate","volumeChange","seeking","seeked","rateChange","presentationModeChanged"].forEach((function(e){u.addEventListener(e.toLowerCase(),(function(t){n[e].call(s)}))})),window.addEventListener("message",(function(e){var t=e.data,n=t;try{"string"==typeof n&&(n=JSON.parse(t))}catch(e){}if(function(e){return n=typeof(t=e),null!=t&&("object"==n||"function"==n)&&"eventType"in e;var t,n}(n))switch(n.eventType){case"set-play":s.actions.setPlay.call(s);break;case"set-pause":s.actions.setPause.call(s);break;case"set-muted":s.actions.setMuted.call(s,n.value);break;case"set-presentation-mode":s.actions.setPresentationMode.call(s,n.value);break;case"get-duration":s.actions.getDuration.call(s);break;case"get-current-time":s.actions.getCurrentTime.call(s);break;case"get-muted":s.actions.getMuted.call(s);break;case"get-presentation-mode":s.actions.getPresentationMode.call(s);break;case"get-playbackRate":s.actions.getPlayBackRate.call(s)}}),!1)}return o.prototype.postVideoMessage=function(e){this.config.targetWindow.postMessage(JSON.stringify(e),"*")},o}();module.exports=o;
